<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MY APP</title>
    <link class="jsbin" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<
<body>
<p id="mensaje">aa</p>
<form action="javascript:;" onsubmit="registrar()" >
    <input type="text" id="user" name="usuario" placeholder="Usuario" required="required"/>
    <input type="email" id="email" name="correo" placeholder="Correo electrónico" required="required" />
    <input type="password" id="password" name="contra" placeholder="contrasñea" required="required"/>
    <input type="submit" value="Submit">
</form>

<p id="mensaje2">aa</p>
<form action="javascript:;" onsubmit="inicSesion()" >
    <input type="email" id="emailIS" name="correo" placeholder="Correo electrónico" required="required" />
    <input type="password" id="passwordIS" name="contra" placeholder="contrasñea" required="required"/>
    <input type="submit" value="Submit">
</form>

<form style="display: none" action="http://localhost:8080/inicio" method="POST" id="formoculto">
    <input type="hidden" id="var1" name="userId" value=""/>
</form>

</body>
</html>
<script>
    async function registrar (){
        const user=document.getElementById('user').value;
        const email=document.getElementById('email').value;
        const password=document.getElementById('password').value;
        const mensaje = document.getElementById('mensaje');
        let caca;
        await fetch('http://localhost:8080/registrar', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "usuario": user, "correo": email,"contra": password })
        })
                .then(response => response.json())
                .then(response => {
                    caca = response
                })
        if (caca.resu==1)
            mensaje.innerText='El usuario ya existe'
        if (caca.resu==2)
            mensaje.innerText='El Correo ya está registrado'
        if (caca.resu==3)
            mensaje.innerText='Registrado con éxito'
    }
    async function inicSesion (){
        const email=document.getElementById('emailIS').value;
        const password=document.getElementById('passwordIS').value;
        const mensaje = document.getElementById('mensaje2');
        const formO = document.getElementById('formoculto');
        const ide = document.getElementById('var1');
        let caca;
        await fetch('http://localhost:8080/iniciarSesion', {
            method: 'POST',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ "correo": email,"contra": password })
        })
                .then(response => response.json())
                .then(response => {
                    caca = response;
                })
        if (caca.resu==1)
            mensaje.innerText='No hay un usuario registrado con ese correo';
        if (caca.resu==2)
            mensaje.innerText='contraseña incorrecta';
        if (caca.resu==3){
            ide.value=caca.us
            formO.submit();
        }


    }
</script>
